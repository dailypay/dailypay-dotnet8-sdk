name: "Scan"

on:
  workflow_dispatch:
    inputs:
      branch_name:
        description: Branch name to target scan on
        default: main
        required: true
        type: string
  workflow_call:
    inputs:
      branch_name:
        description: Branch name to target scan on
        required: true
        type: string

permissions:
  pull-requests: write
  contents: write
  security-events: write
  id-token: write

jobs:
  scan:
    runs-on: ubuntu-latest
    env:
      DOTNET_INSTALL_DIR: "./.dotnet"
    strategy:
      matrix:
        branch: ["${{ inputs.branch_name }}"]
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Configure Git
        uses: dailypay/actions-commons/git-configure@v0

      - name: Install Dotnet 8
        uses: actions/setup-dotnet@v4
        with:
          dotnet-version: 8.x

      - name: Scan
        uses: jfrog/frogbot@v2
        env:
          JF_URL: https://artifactory.dailypay.com
          JF_GIT_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          JF_GIT_BASE_BRANCH: ${{ matrix.branch }}
        with:
          oidc-provider-name: github
          oidc-audience: dailypay-github
          version: ${{ vars.FROGBOT_VERSION }}

